 ğŸ§  TCP Server Explained â€” â€œShourovâ€™s Server Roomâ€

## ğŸ“– The Story Begins: Shourovâ€™s Server Room
One day, Shourov built a â€œserver roomâ€ inside his computer.  
This room works like magic â€” whenever someone knocks on the door (meaning connects), Shourov opens it and says:

> â€œHey there! What do you need?â€ ğŸ˜„  

That server room is basically a **TCP Server**.

---

## âš™ï¸ What Does a TCP Server Do?
Shourovâ€™s server follows a strict rule called **TCP (Transmission Control Protocol)** â€”  
its job is to make sure:
- No data is lost  
- No data is duplicated  
- And everything arrives in the correct order  

When Shourov sends a message to Aziz uncle, TCP ensures Aziz receives it exactly as it was sent.  
It uses **acknowledgments** (â€œGot it!â€) and **retransmissions** (â€œDidnâ€™t get that, please resend.â€) to ensure reliability.

---

## ğŸ’¬ The Clientâ€“Server Conversation
When Aziz uncle (the client) connects to Shourovâ€™s server, Shourov says:
> â€œYouâ€™ve knocked on my door â€” now weâ€™re connected.â€  

From then on, both can communicate freely â€” Aziz requests, Shourov responds.  
This is the foundation of the **Clientâ€“Server Communication Model**.

---

## ğŸ’» Real-World Example â€” Redis
**Redis**, a popular in-memory database, works exactly like this.  
When you use a Redis client to **SET** or **GET** data,  
your computer establishes a TCP connection to the Redis server and exchanges data.

---

## ğŸŒ In Summary
> A **TCP Server** is a program that establishes reliable connections with clients,  
> receives their requests, and sends back responses using the TCP protocol.

---

# ğŸ‘‘ Shourovâ€™s TCP Kingdom

## âš™ï¸ Core TCP Features

### ğŸ§± 1. Reliable
TCP ensures that no data is lost or reordered.  
If Shourov sends three messages â€” A, B, C â€” Aziz will receive them in the same order.  
If any message is lost, TCP retransmits it automatically.

### ğŸ”— 2. Connection-Oriented
Before communication begins, TCP performs a **Three-Way Handshake**:

1ï¸âƒ£ Client â†’ Server: SYN  
2ï¸âƒ£ Server â†’ Client: SYN + ACK  
3ï¸âƒ£ Client â†’ Server: ACK  

Only then is the connection **ESTABLISHED**.

### ğŸ’§ 3. Stream-Based
TCP transmits data as a continuous stream rather than separate packets â€”  
like a river flowing smoothly ğŸŒŠ

---

## ğŸš€ TCP Connection Lifecycle

1ï¸âƒ£ **Socket Creation** â†’ Shourov opens his ears (creates a socket)  
2ï¸âƒ£ **Binding** â†’ Attaches to a specific IP and Port  
3ï¸âƒ£ **Listening** â†’ Waits for a knock  
4ï¸âƒ£ **Accepting Connections** â†’ Welcomes the client  
5ï¸âƒ£ **Data Exchange** â†’ They talk (PING â†” PONG)  
6ï¸âƒ£ **Termination** â†’ Politely closes the connection  

---

## ğŸ¤ Three-Way Handshake

| Step | Message | Meaning |
|------|----------|----------|
| 1ï¸âƒ£ | SYN | Client: â€œI want to connect.â€ |
| 2ï¸âƒ£ | SYN + ACK | Server: â€œI hear you and Iâ€™m ready.â€ |
| 3ï¸âƒ£ | ACK | Client: â€œLetâ€™s talk!â€ |

ğŸ“ Both are now in **ESTABLISHED** state â€” connection ready! ğŸ‰

---

## ğŸ§¹ Connection Termination

| Step | Direction | Description |
|------|------------|-------------|
| 1ï¸âƒ£ | Client â†’ Server | Sends FIN (says goodbye) |
| 2ï¸âƒ£ | Server â†’ Client | Sends ACK |
| 3ï¸âƒ£ | Server â†’ Client | Sends FIN |
| 4ï¸âƒ£ | Client â†’ Server | Sends ACK (connection closed) |

Finally, both sides move to the **CLOSED** state.

---

## â˜• Shourovâ€™s Tea Stall â€” Understanding Sockets

Imagine Shourov opens a small tea stall â˜•  
The door is his **socket**.  
When Aziz uncle says, â€œOne cup of tea, please!â€  
They establish a communication channel â€” thatâ€™s **Socket Communication**.

**In short:**  
> Socket = Network Communication Endpoint  

In Python, this is easily handled using the `socket` module.

---

## âš™ï¸ Types of Sockets

| Type | Description |
|------|--------------|
| AF_INET | IPv4 communication |
| SOCK_STREAM | Reliable TCP stream |
| SOCK_DGRAM | Fast but unreliable UDP communication |

---

## ğŸª„ Key Socket Functions

| Function | Purpose |
|-----------|----------|
| socket() | Create a new socket |
| bind() | Assign IP and port |
| listen() | Start listening for connections |
| accept() | Accept a client connection |
| recv() | Receive data |
| send() | Send data |
| close() | Close the connection |

---

## âš™ï¸ Redisâ€™ TCP Server Model

Redis handles thousands of clients at once using a **single-threaded event loop**.  
That means one thread continuously listens for:
- Who is connecting  
- Who is sending a command  
- Who needs a response  

This makes Redis simple and extremely fast â€” without multithreading complexity.

---

## ğŸ§ª Lab 1: Minimal TCP Server (Python)

```python
import socket
import threading

class TCPServer:
    def __init__(self, host='localhost', port=6379):
        self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        self.server_socket.bind((host, port))
        self.server_socket.listen(5)
        print(f"Server listening on {host}:{port}")
    
    def handle_client(self, conn, addr):
        print(f"Connected by {addr}")
        try:
            while True:
                data = conn.recv(1024).decode().strip()
                if not data:
                    break
                if data.upper() == "PING":
                    conn.send(b"+PONG\r\n")
                else:
                    conn.send(b"-ERR Unknown command\r\n")
        except Exception as e:
            conn.send(f"-ERR {str(e)}\r\n".encode())
        finally:
            conn.close()
            print(f"Disconnected: {addr}")
    
    def run(self):
        try:
            while True:
                conn, addr = self.server_socket.accept()
                threading.Thread(target=self.handle_client, args=(conn, addr)).start()
        except KeyboardInterrupt:
            print("\nShutting down server...")
        finally:
            self.server_socket.close()

if __name__ == "__main__":
    server = TCPServer()
    server.run()
```

---

## ğŸ” How to Run It

1ï¸âƒ£ Save the file as `tcp_server.py`  
2ï¸âƒ£ Run it:
```bash
python tcp_server.py
```
3ï¸âƒ£ Open another terminal:
```bash
telnet localhost 6379
```
4ï¸âƒ£ Type:
```
PING
```
ğŸ“© Response:
```
+PONG
```

5ï¸âƒ£ Type:
```
HELLO
```
ğŸ“© Response:
```
-ERR Unknown command
```

âœ… You can open multiple terminals and connect simultaneously.

---

## ğŸ§­ Summary

| Concept | Description |
|----------|--------------|
| Socket | A network communication door |
| TCP | Reliable, connection-oriented protocol |
| Redis Model | Single-threaded event loop (fast and simple) |
| Python Socket Server | Mini Redis-like TCP server |
| Command | PING â†’ PONG, others return error |

---

## ğŸ’¬ PING â†” PONG Explained

**PING â†” PONG** are simple test messages used to check if the connection is alive.

### ğŸ§  Example
Aziz: â€œHey, can you hear me?â€ ğŸ”Š â†’ PING  
Shourov: â€œYes, Iâ€™m here!â€ â˜• â†’ PONG  

### âš™ï¸ Technically
- **PING:** Client asks if the server is alive.  
- **PONG:** Server confirms itâ€™s active.  
- If no PONG is received â†’ the server is likely down or disconnected.

### ğŸ§± In Redis
Command:
```
PING
```
Response:
```
PONG
```

That means â€” the Redis server is running fine âœ…
